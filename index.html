<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M…ômm…ôd & S…ôid…ô ‚Äî Toy D…ôv…ôti</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fffaf7;
      --text:#1b1814;
      --muted:#6e655a;
      --gold1:#d7b15a;
      --gold2:#f3e2b6;
      --line: rgba(210,180,120,.25);
      --line2: rgba(210,180,120,.3);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:var(--bg);
      font-family:Inter,sans-serif;
      color:var(--text);
    }

    .wrap{
      max-width:460px;
      margin:auto;
      padding:18px 16px 40px;
      opacity:0;
      transform: translateY(10px);
      animation: pageIn .7s ease forwards;
    }
    @keyframes pageIn{ to{ opacity:1; transform: translateY(0);} }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 14px;
      border-radius:18px;
      background:#fff;
      border:1px solid var(--line);
      margin-bottom:16px;
    }
    header b{
      font-family:"Playfair Display",serif;
      font-size:14px;
    }

    .card{
      background:#fff;
      border-radius:26px;
      border:1px solid var(--line);
      margin-bottom:16px;
      overflow:hidden;
    }

    /* Cover */
    .cover{
      height:460px;
      background:url("cover.jpg") center top/cover no-repeat;
    }

    .title{
      text-align:center;
      padding:18px;
    }
    .title .dateTop{
      letter-spacing:.12em;
      color:var(--muted);
      font-size:12px;
      text-transform:uppercase;
    }
    .title h1{
      font-family:"Playfair Display",serif;
      font-size:30px;
      margin:6px 0;
      white-space:nowrap;
    }
    .subtitle{
      font-size:13px;
      color:var(--muted);
      margin:0;
    }

    /* Info grid */
    .quick{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      padding:0 18px 18px;
    }
    .qitem{
      border:1px solid var(--line);
      border-radius:18px;
      padding:10px;
      background:#fff;
    }
    .qitem small{
      color:var(--muted);
      font-size:12px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .qicon{
      width:22px;height:22px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
      background: rgba(215,177,90,.15);
    }
    .qitem b{
      font-size:14px;
      display:block;
      margin-top:6px;
      line-height:1.2;
    }
    .quick .qitem:nth-child(3){
      grid-column:1/-1;
    }

    /* Buttons stack */
    .nav{ padding:0 18px 18px; }
    .navStack{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .navStack a{
      display:block;
      width:100%;
      text-align:center;
      text-decoration:none;
      padding:14px;
      border-radius:999px;
      font-size:14px;
      font-weight:700;
    }

    /* Calendar button */
    .calBtn{
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      white-space:nowrap;
    }
    .calBtn.burst{ animation:pulse .3s ease; }
    @keyframes pulse{
      0%{transform:scale(1)}
      50%{transform:scale(1.07)}
      100%{transform:scale(1)}
    }

    /* üíõ Wish button glow */
    .wishNavBtn{
      position:relative;
      overflow:hidden;
      border:none;
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      color:#000;
      font-weight:900;
      box-shadow:0 10px 26px rgba(215,177,90,.22);
    }
    .wishNavBtn::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.65), transparent 55%);
      transform:translateX(-35%);
      opacity:.35;
      animation:wishGlow 2.8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes wishGlow{
      0%{transform:translateX(-35%);opacity:.28}
      50%{transform:translateX(35%);opacity:.45}
      100%{transform:translateX(-35%);opacity:.28}
    }

    section{ padding:20px; }

    /* Countdown */
    .countdown{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
    }
    .box{
      border:1px solid var(--line);
      border-radius:18px;
      padding:12px;
      text-align:center;
      background:#fff;
    }
    .box b{ font-size:20px; }
    .box small{ color:var(--muted); }

    /* Program */
    .programList{
      display:flex;
      flex-direction:column;
      gap:18px;
      margin-top:10px;
    }
    .programItem{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .programLeft{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:600;
    }
    .dotGold{
      width:8px;height:8px;border-radius:50%;
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      flex:0 0 auto;
    }
    .programTime{ color:var(--muted); font-weight:600; }

    /* Map */
    .addressSection h2{
      letter-spacing:4px;
      font-size:14px;
      color:var(--muted);
      margin:0 0 8px;
    }
    .addressSection h3{ margin:0 0 12px; }
    .mapWrap iframe{
      width:100%;
      height:260px;
      border-radius:22px;
      border:1px solid var(--line);
    }
    .mapButtons{
      display:flex;
      gap:12px;
      margin-top:16px;
    }
    .copyBtn{
      flex:1;
      padding:12px;
      border-radius:18px;
      border:1px solid var(--line2);
      background:#fff;
      font-weight:700;
    }
    .directionBtn{
      flex:1;
      padding:12px;
      border-radius:18px;
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      text-align:center;
      text-decoration:none;
      color:#000;
      font-weight:800;
    }

    /* Music */
    .musicBtn{
      position:fixed;
      right:16px;
      bottom:16px;
      padding:12px 14px;
      border-radius:999px;
      border:1px solid var(--line2);
      background:#fff;
      z-index:50;
      font-weight:700;
    }

    /* ===== üíõ WISH MODAL (bottom sheet) ===== */
    .wishOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.35);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
      display:flex;
      align-items:flex-end;
      justify-content:center;
      opacity:0;
      pointer-events:none;
      transition:.25s ease;
      z-index:9999;
    }
    .wishOverlay.active{
      opacity:1;
      pointer-events:auto;
    }
    .wishSheet{
      width:100%;
      max-width:460px;
      background:#fff;
      border-radius:26px 26px 0 0;
      padding:18px 18px 22px;
      transform:translateY(100%);
      transition:.32s ease;
      border:1px solid var(--line);
      border-bottom:none;
    }
    .wishOverlay.active .wishSheet{
      transform:translateY(0);
    }
    .wishHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }
    .wishHeader h3{
      margin:0;
      font-size:20px;
      letter-spacing:.02em;
    }
    #closeWish{
      border:none;
      background:#f3f3f3;
      width:42px;
      height:42px;
      border-radius:14px;
      font-size:18px;
      cursor:pointer;
    }
    .wishInput,
    .wishTextarea{
      width:100%;
      border:1px solid var(--line2);
      border-radius:18px;
      padding:14px;
      margin-top:12px;
      font-size:14px;
      background:#fafafa;
      outline:none;
    }
    .wishTextarea{
      min-height:90px;
      resize:none;
    }
    .wishButtons{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
      margin-top:14px;
    }
    .wishBtn{
      padding:12px;
      border-radius:20px;
      border:none;
      font-weight:800;
      cursor:pointer;
    }
    .wishBtn.primary{
      background:linear-gradient(135deg,var(--gold1),var(--gold2));
      color:#000;
    }
    .wishBtn.secondary{
      background:#f3f3f3;
      color:#000;
    }
    .wishBtn:disabled{
      opacity:.55;
      cursor:not-allowed;
    }
    .wishNote{
      font-size:12px;
      color:#777;
      margin-top:12px;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <b>M…ômm…ôd & S…ôid…ô ‚Ä¢ Toy D…ôv…ôti</b>
    </header>

    <div class="card">
      <div class="cover"></div>

      <div class="title">
        <div class="dateTop">30 MART 2026</div>
        <h1>M∆èMM∆èD & S∆èƒ∞D∆è</h1>
        <p class="subtitle">Sevgi il…ô sizi h…ôyatƒ±mƒ±zƒ±n …ôn xo≈ü g√ºn√ºn√º birlikd…ô qeyd etm…ôy…ô d…ôv…ôt edirik üíõ</p>
      </div>

      <div class="quick">
        <div class="qitem">
          <small><span class="qicon">üìÖ</span>Tarix</small>
          <b>30 Mart 2026</b>
        </div>

        <div class="qitem">
          <small><span class="qicon">üïí</span>Saat</small>
          <b>18:00</b>
        </div>

        <div class="qitem">
          <small><span class="qicon">üìç</span>M…ôkan</small>
          <b>≈ûah…ôn≈üah Premium Hall</b>
        </div>
      </div>

      <div class="nav navStack">
        <a href="wedding.ics" id="addToCalendar" class="calBtn">T…ôqvim…ô …ôlav…ô et üìÖ</a>

        <!-- üíõ Button opens bottom sheet -->
        <a href="#" id="wishBtn" class="wishNavBtn">Arzu g√∂nd…ôr üíõ</a>
      </div>
    </div>

    <div class="card">
      <section id="count">
        <h3>Geri sayƒ±m</h3>
        <div class="countdown">
          <div class="box"><b id="d">0</b><small>G√ºn</small></div>
          <div class="box"><b id="h">0</b><small>Saat</small></div>
          <div class="box"><b id="m">0</b><small>D…ôq</small></div>
          <div class="box"><b id="s">0</b><small>San</small></div>
        </div>
      </section>
    </div>

    <div class="card" id="program">
      <section>
        <h3>PROQRAM</h3>
        <div class="programList">
          <div class="programItem">
            <div class="programLeft"><span class="dotGold"></span>Qonaqlarƒ±n qar≈üƒ±lanmasƒ±</div>
            <div class="programTime">18:00</div>
          </div>
          <div class="programItem">
            <div class="programLeft"><span class="dotGold"></span>Toyun ba≈ülamasƒ±</div>
            <div class="programTime">19:00</div>
          </div>
          <div class="programItem">
            <div class="programLeft"><span class="dotGold"></span>ƒ∞lk r…ôqs</div>
            <div class="programTime">19:15</div>
          </div>
          <div class="programItem">
            <div class="programLeft"><span class="dotGold"></span>Tort</div>
            <div class="programTime">21:30</div>
          </div>
          <div class="programItem">
            <div class="programLeft"><span class="dotGold"></span>Disko</div>
            <div class="programTime">22:00</div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚úÖ Map section (kept) -->
    <div class="card" id="map">
      <section class="addressSection">
        <h2>√úNVAN</h2>
        <h3>≈ûah…ôn≈üah Premium Hall</h3>

        <div class="mapWrap">
          <iframe
            src="https://maps.google.com/maps?q=≈ûah…ôn≈üah%20Premium%20Hall&t=&z=15&ie=UTF8&iwloc=&output=embed"
            loading="lazy"></iframe>
        </div>

        <div class="mapButtons">
          <button class="copyBtn" id="copyAddress">√únvanƒ± kopyala</button>
          <a class="directionBtn" href="https://maps.app.goo.gl/Q2AetF1tLfobqmAT8" target="_blank" rel="noopener">ƒ∞stiqam…ôt</a>
        </div>
      </section>
    </div>
  </div>

  <button class="musicBtn" id="musicBtn">üéµ Musiqini ba≈ülat</button>

  <!-- ‚úÖ Autoplay muted + first touch unmute -->
  <audio id="bgMusic" loop preload="auto" autoplay muted playsinline>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <!-- üíõ WISH MODAL -->
  <div id="wishOverlay" class="wishOverlay" aria-hidden="true">
    <div class="wishSheet" role="dialog" aria-modal="true" aria-label="Arzu">
      <div class="wishHeader">
        <h3>Arzu</h3>
        <button id="closeWish" aria-label="Baƒüla">‚úï</button>
      </div>

      <input id="wishName" type="text" placeholder="Adƒ±nƒ±z v…ô soyadƒ±nƒ±z" class="wishInput" />
      <textarea id="wishMessage" placeholder="Qeyd (ist…ôy…ô g√∂r…ô)" class="wishTextarea"></textarea>

      <div class="wishButtons">
        <button id="recBtn" class="wishBtn secondary">üé§ S…ôs yaz</button>
        <button id="sendWish" class="wishBtn primary">‚¨Ü G√∂nd…ôr</button>
        <button id="playBtn" class="wishBtn secondary" disabled>‚ñ∂ Dinl…ô</button>
        <button id="downloadBtn" class="wishBtn secondary" disabled>‚¨á Y√ºkl…ô</button>
      </div>

      <p id="wishStatus" class="wishNote">
        S…ôs yaz ‚Üí dinl…ô ‚Üí <b>G√∂nd…ôr</b>. G√∂nd…ôrdikd…ôn sonra ‚ÄúG√ñND∆èRƒ∞LDƒ∞ ‚úì‚Äù g√∂r…ôc…ôksiniz.
      </p>
    </div>
  </div>

  <script>
    // =========================
    // COUNTDOWN
    // =========================
    const target = new Date("2026-03-30T18:00:00").getTime();
    setInterval(() => {
      const now = Date.now();
      let diff = target - now;
      if (diff < 0) diff = 0;

      document.getElementById("d").textContent = Math.floor(diff / (1000*60*60*24));
      document.getElementById("h").textContent = Math.floor(diff / (1000*60*60)) % 24;
      document.getElementById("m").textContent = Math.floor(diff / (1000*60)) % 60;
      document.getElementById("s").textContent = Math.floor(diff / 1000) % 60;
    }, 1000);

    // =========================
    // COPY ADDRESS
    // =========================
    const copyBtn = document.getElementById("copyAddress");
    if (copyBtn) {
      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText("≈ûah…ôn≈üah Premium Hall");
          copyBtn.textContent = "Kopyalandƒ± ‚úì";
          setTimeout(() => copyBtn.textContent = "√únvanƒ± kopyala", 1200);
        } catch(e) {
          alert("Kopyalama alƒ±nmadƒ±.");
        }
      });
    }

    // =========================
    // CALENDAR BUTTON PULSE
    // =========================
    const cal = document.getElementById("addToCalendar");
    if (cal) {
      cal.addEventListener("click", () => {
        cal.classList.remove("burst");
        void cal.offsetWidth;
        cal.classList.add("burst");
      });
    }

    // =========================
    // MUSIC: muted autoplay, then any screen tap enables sound + 2s fade-in
    // =========================
    const music = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    let soundEnabled = false;

    function fadeInAudio(duration = 2000){
      try { music.volume = 0; } catch(e) {}
      const start = performance.now();
      function step(now){
        const progress = Math.min((now - start) / duration, 1);
        try { music.volume = progress; } catch(e) {}
        if(progress < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    window.addEventListener("load", async () => {
      try {
        music.muted = true;
        await music.play();
      } catch(e) {}
    });

    async function enableSound(){
      if (soundEnabled) return;
      try{
        music.muted = false;
        await music.play();
        fadeInAudio(2000);
        soundEnabled = true;
        musicBtn.textContent = "‚è∏Ô∏è Musiqini dayandƒ±r";
      }catch(e){}
      document.removeEventListener("pointerdown", enableSound);
      document.removeEventListener("touchstart", enableSound);
    }
    document.addEventListener("pointerdown", enableSound, { once:true });
    document.addEventListener("touchstart", enableSound, { once:true, passive:true });

    musicBtn.addEventListener("click", async () => {
      try{
        if (music.paused) {
          music.muted = false;
          await music.play();
          fadeInAudio(2000);
          soundEnabled = true;
          musicBtn.textContent = "‚è∏Ô∏è Musiqini dayandƒ±r";
        } else {
          music.pause();
          soundEnabled = false;
          musicBtn.textContent = "üéµ Musiqini ba≈ülat";
        }
      }catch(e){
        alert("S…ôs √º√ß√ºn icaz…ô verilm…ôdi.");
      }
    });

    // =========================
    // üíõ HEART BURST (for wish button click)
    // =========================
    function burstHeartsAt(x, y){
      const count = 10;
      for(let i=0;i<count;i++){
        const h = document.createElement("span");
        h.textContent = "üíõ";
        h.style.position = "fixed";
        h.style.left = x + "px";
        h.style.top = y + "px";
        h.style.transform = "translate(-50%,-50%)";
        h.style.fontSize = (12 + Math.random()*10) + "px";
        h.style.zIndex = "99999";
        h.style.pointerEvents = "none";
        h.style.transition = "transform 700ms ease, opacity 700ms ease";
        h.style.opacity = "1";
        document.body.appendChild(h);

        const dx = (Math.random()-0.5)*140;
        const dy = -(60 + Math.random()*120);
        const rot = (Math.random()-0.5)*60;

        requestAnimationFrame(() => {
          h.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) rotate(${rot}deg)`;
          h.style.opacity = "0";
        });

        setTimeout(()=>h.remove(), 760);
      }
    }

    // =========================
    // üíõ WISH MODAL + REAL AUDIO + GOOGLE SHEETS
    // =========================

    // 1) BURAYA Apps Script Web App URL-ni yaz:
    const WISH_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyBmxL3pFPB5Mx2Pr7dJR0GqdeyXPrcqkuk65ntQb87b8jz4VDqk-mp0ZLhe8qwSm8crA/exec";

    const wishBtn = document.getElementById("wishBtn");
    const wishOverlay = document.getElementById("wishOverlay");
    const closeWish = document.getElementById("closeWish");

    const wishNameEl = document.getElementById("wishName");
    const wishMessageEl = document.getElementById("wishMessage");

    const recBtn = document.getElementById("recBtn");
    const playBtn = document.getElementById("playBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const sendWishBtn = document.getElementById("sendWish");
    const wishStatus = document.getElementById("wishStatus");

    function setStatus(text, ok=true){
      wishStatus.innerHTML = text;
      wishStatus.style.color = ok ? "#777" : "#b00020";
    }

    function openWishModal(){
      wishOverlay.classList.add("active");
      wishOverlay.setAttribute("aria-hidden","false");
      // focus
      setTimeout(()=>wishNameEl.focus(), 150);
    }

    function closeWishModal(){
      wishOverlay.classList.remove("active");
      wishOverlay.setAttribute("aria-hidden","true");
    }

    // Modal open/close
    wishBtn.addEventListener("click", (e) => {
      e.preventDefault();
      burstHeartsAt(e.clientX || (window.innerWidth/2), e.clientY || (window.innerHeight/2));
      openWishModal();
    });

    closeWish.addEventListener("click", closeWishModal);
    wishOverlay.addEventListener("click", (e) => {
      if (e.target === wishOverlay) closeWishModal();
    });
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape" && wishOverlay.classList.contains("active")) closeWishModal();
    });

    // Audio recorder state
    let mediaRecorder = null;
    let recordedChunks = [];
    let recordedBlob = null;
    let recordedUrl = null;
    let recordedMime = "audio/webm";
    let isRecording = false;

    function resetRecording(){
      recordedChunks = [];
      recordedBlob = null;
      if(recordedUrl) URL.revokeObjectURL(recordedUrl);
      recordedUrl = null;
      playBtn.disabled = true;
      downloadBtn.disabled = true;
    }

    async function startRecording(){
      resetRecording();

      const stream = await navigator.mediaDevices.getUserMedia({ audio:true });

      const candidates = [
        "audio/webm;codecs=opus",
        "audio/webm",
        "audio/ogg;codecs=opus",
        "audio/ogg"
      ];

      let mime = "";
      for(const c of candidates){
        if (window.MediaRecorder && MediaRecorder.isTypeSupported && MediaRecorder.isTypeSupported(c)) {
          mime = c;
          break;
        }
      }
      recordedMime = mime || "";

      mediaRecorder = new MediaRecorder(stream, mime ? { mimeType: mime } : undefined);

      mediaRecorder.ondataavailable = (ev) => {
        if (ev.data && ev.data.size > 0) recordedChunks.push(ev.data);
      };

      mediaRecorder.onstop = () => {
        stream.getTracks().forEach(t => t.stop());

        recordedBlob = new Blob(recordedChunks, { type: mediaRecorder.mimeType || "audio/webm" });
        recordedMime = recordedBlob.type || "audio/webm";
        recordedUrl = URL.createObjectURL(recordedBlob);

        playBtn.disabled = false;
        downloadBtn.disabled = false;

        setStatus("‚úÖ S…ôs yazƒ±ldƒ±. ƒ∞ndi <b>Dinl…ô</b> v…ô ya <b>G√∂nd…ôr</b> ed…ô bil…ôrsiniz.");
      };

      mediaRecorder.start();
    }

    function stopRecording(){
      if(mediaRecorder && mediaRecorder.state !== "inactive"){
        mediaRecorder.stop();
      }
    }

    recBtn.addEventListener("click", async () => {
      try{
        if(!isRecording){
          setStatus("üéôÔ∏è Yazƒ±lƒ±r... Dayandƒ±rmaq √º√ß√ºn yen…ô basƒ±n.");
          await startRecording();
          isRecording = true;
          recBtn.textContent = "‚èπ Dayandƒ±r";
          recBtn.classList.remove("secondary");
          recBtn.classList.add("primary");
        }else{
          stopRecording();
          isRecording = false;
          recBtn.textContent = "üé§ S…ôs yaz";
          recBtn.classList.add("secondary");
          recBtn.classList.remove("primary");
        }
      }catch(err){
        setStatus("‚ùå Mikrofon icaz…ôsi verilm…ôdi v…ô ya cihaz d…ôst…ôkl…ômir.", false);
      }
    });

    playBtn.addEventListener("click", () => {
      if(!recordedUrl) return;
      const a = new Audio(recordedUrl);
      a.play();
    });

    downloadBtn.addEventListener("click", () => {
      if(!recordedBlob) return;
      const ext = recordedMime.includes("ogg") ? "ogg" : (recordedMime.includes("webm") ? "webm" : "audio");
      const link = document.createElement("a");
      link.href = recordedUrl;
      link.download = `arzu-${Date.now()}.${ext}`;
      document.body.appendChild(link);
      link.click();
      link.remove();
    });

    function blobToBase64(blob){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => {
          const res = reader.result; // data:...base64,XXXX
          const base64 = String(res).split(",")[1] || "";
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }

    sendWishBtn.addEventListener("click", async () => {
      try{
        if(!WISH_WEB_APP_URL || WISH_WEB_APP_URL.includes("PASTE_")){
          setStatus("‚ùå Web App URL …ôlav…ô edilm…ôyib. Apps Script URL-ni WISH_WEB_APP_URL yerin…ô yazƒ±n.", false);
          return;
        }

        const name = (wishNameEl.value || "").trim();
        const note = (wishMessageEl.value || "").trim();

        if(!name){
          setStatus("‚ùå Z…ôhm…ôt olmasa adƒ±nƒ±zƒ± yazƒ±n.", false);
          return;
        }

        setStatus("‚è≥ G√∂nd…ôrilir...");

        let audioBase64 = "";
        let audioMime = "";

        if(recordedBlob){
          audioBase64 = await blobToBase64(recordedBlob);
          audioMime = recordedMime || recordedBlob.type || "audio/webm";
        }

        const payload = { name, note, audioBase64, audioMime };

        const resp = await fetch(WISH_WEB_APP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const out = await resp.json().catch(()=>({ok:false}));
        if(out && out.ok){
          setStatus("‚úÖ <b>G√ñND∆èRƒ∞LDƒ∞ ‚úì</b> T…ô≈ü…ôkk√ºrl…ôr üíõ");
          // ƒ∞st…ôs…ôn auto close:
          // setTimeout(closeWishModal, 900);
        }else{
          setStatus("‚ùå G√∂nd…ôrm…ô alƒ±nmadƒ±. Bir az sonra yen…ô yoxlayƒ±n.", false);
        }
      }catch(err){
        setStatus("‚ùå X…ôta ba≈ü verdi. ƒ∞nternetinizi yoxlayƒ±n.", false);
      }
    });
  </script>
</body>
</html>
